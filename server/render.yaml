# ===========================================
# Render Deployment Configuration
# Documentation: https://render.com/docs/yaml-spec
# ===========================================

services:
  - type: web
    name: musicvista-api
    runtime: node
    region: oregon              # Region: oregon (US West), frankfurt (EU), singapore (Asia)
    plan: free                  # Free tier
    
    # Build configuration (no rootDir needed since yaml is in server directory)
    buildCommand: npm ci && npm run build
    startCommand: npm start
    
    # Health check
    healthCheckPath: /health
    
    # Auto deploy (triggered by Git push)
    autoDeploy: true
    
    # Environment variables
    envVars:
      # Node environment
      - key: NODE_ENV
        value: production
      
      - key: PORT
        value: 3001
      
      # Database configuration (add actual values manually in Dashboard)
      - key: DB_HOST
        sync: false             # Needs to be configured manually in Dashboard
      
      - key: DB_PORT
        value: 5432
      
      - key: DB_NAME
        sync: false
      
      - key: DB_USER
        sync: false
      
      - key: DB_PASSWORD
        sync: false
      
      # JWT configuration (Render auto-generates secure keys)
      - key: JWT_ACCESS_SECRET
        generateValue: true     # Render auto-generates random value
      
      - key: JWT_REFRESH_SECRET
        generateValue: true
      
      - key: JWT_ACCESS_EXPIRATION
        value: 15m
      
      - key: JWT_REFRESH_EXPIRATION
        value: 7d
      
      # CORS configuration (update after frontend deployment)
      - key: FRONTEND_URL
        value: https://musicvista.vercel.app
      
      - key: CORS_ORIGINS
        value: https://musicvista.vercel.app,http://localhost:5173
      
      # Log level
      - key: LOG_LEVEL
        value: info

# ===========================================
# üìã Deployment Steps:
#
# 1. Commit this file to Git:
#    git add server/render.yaml
#    git commit -m "feat: add Render deployment config"
#    git push
#
# 2. Visit Render Dashboard:
#    https://dashboard.render.com
#
# 3. Choose one deployment method:
#
#    Method A - Blueprint (Recommended):
#    - New ‚Üí Blueprint
#    - Connect GitHub repository
#    - Render auto-detects render.yaml
#    - Add sensitive environment variables in Dashboard (DB_HOST, DB_PASSWORD, etc.)
#    - Click Apply to start deployment
#
#    Method B - Manual creation:
#    - New ‚Üí Web Service
#    - Connect GitHub repository
#    - Root Directory: try/clean/server
#    - Other configurations will be read from yaml by Render
#    - Add sensitive environment variables
#    - Create Web Service
#
# 4. After deployment:
#    - Get URL: https://musicvista-api.onrender.com
#    - Test health check: https://musicvista-api.onrender.com/health
#    - Update frontend environment variable: VITE_API_BASE_URL
#
# ===========================================

# ===========================================
# ‚ö†Ô∏è Important Notes:
#
# 1. Sensitive environment variables need to be added manually in Render Dashboard:
#    - DB_HOST (AWS RDS address)
#    - DB_NAME (millionsongsubset)
#    - DB_USER (postgres)
#    - DB_PASSWORD (your actual password)
#
# 2. JWT secrets will be auto-generated, no manual configuration needed
#
# 3. Free tier limitations:
#    - Service sleeps after 15 minutes of inactivity
#    - Cold start takes 30-60 seconds
#    - 750 hours per month runtime
#
# 4. Solutions for sleep issue:
#    - Use cron-job.org for scheduled pings
#    - Or upgrade to paid plan ($7/month)
#
# ===========================================
